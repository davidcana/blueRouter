let blueRouter={start:function(t){if(this.options={},this.utils.extend(this.options,this.defaultOptions,t),this.checkOptions(),this.options.preloadPagesOnLoad){let t=this;void this.htmlFetcher.loadAllUrls(this,()=>{t.init()})}else this.init()},init:function(){this.routesMap=this.createRoutesMap(),this.stack=[],this.addEventListenersForWindow(),this.navigateUrl(this.options.updateOnLoad?window.location.href:"",this.options.animateTransitionsOnLoad)},checkOptions:function(){let t=0,e="";this.options.routes||(++t,e+="routes must be defined. "),this.options.eventsByPage||(++t,e+="eventsByPage must be defined. "),t&&this.alertError("Unable to initalize Blue router. "+t+" errors found: "+e)},alertError:function(t){throw alert(t),t},addEventListenersForWindow:function(){window.onpopstate=t=>{this.navigateUrl(window.location.href,!0)}},addEventListenersForLinks:function(t){let n=this;this.utils.addEventListenerOnList(document.getElementById(t).getElementsByTagName("a"),"click",t=>{var e=t.target.getAttribute("href");e.startsWith(n.options.PAGE_PREFIX)&&(t.preventDefault(),history.pushState({page:e},"page "+e,"#"+e),n.navigateUrl(e,!0))})},createRoutesMap:function(){let e={};return(this.options.routes||[]).map(t=>{e[t.id]=t}),e},getRouteItem:function(t){var e=this.routesMap[t];return e||this.routesMap[this.options.PAGE_ID_404_ERROR]||{id:this.options.PAGE_ID_404_ERROR,content:"<h3>404 - Page not found: "+t+"</h3>"}},navigateUrl:function(t,n){let i=this.utils.analizeUrl(t,this.options),s=this.updateStack(i.page);if(s!=i.page){t=this.getContentForPage(i.page);let e=this;t instanceof Promise?t.then(function(t){e.getRouteItem(i.page).content=t,e.doPageTransition(t,i.page,s,i,n)}):this.doPageTransition(t,i.page,s,i,n)}},updateStack:function(t){var e;return this.stack[this.stack.length-2]==t?this.stack.pop():(e=this.stack[this.stack.length-1],this.stack.push(t),e)},getContentForPage:function(t){t=this.getRouteItem(t);return this.getContentForRoute(t)},getContentForRoute:function(t){if(t.keepAlive){var e=document.getElementById(t.id);if(e)return e}var e=t.content;return e||((e=t.url)?this.htmlFetcher.loadUrl(e):'<div id="error">No content found for route from path '+t.id+"</div>")},doPageTransition:function(t,e,n,i,s){var o=s&&!!this.options.animationOut;let a=s&&!!this.options.animationIn,r=t instanceof HTMLElement?this.defaultOptions.EVENT_REINIT:this.defaultOptions.EVENT_INIT,u=(this.runEvent(this.defaultOptions.EVENT_BEFORE_OUT,n,{}),document.getElementsByClassName("currentPage")[0]),d=this.addNextPage(u,t,e),l=(this.runRenderRelated(r,e,i),this),E=()=>{u.removeEventListener("animationend",E),d.classList.remove("hidden"),a&&d.classList.add(this.options.animationIn),this.retireCurrentPage(n,u),l.runEvent(this.defaultOptions.EVENT_AFTER_OUT,n,{}),a||h()},h=()=>{d.removeEventListener("animationend",h),d.classList.remove("nextPage"),d.classList.add("currentPage"),a&&d.classList.remove(this.options.animationIn),l.runEvent(r,e,i),l.runEvent(this.defaultOptions.EVENT_MOUNTED,e,i)};o&&u.addEventListener("animationend",E),a&&d.addEventListener("animationend",h),o?u.classList.add(this.options.animationOut):E()},runRenderRelated:function(t,e,n){var i=t===this.options.EVENT_INIT?this.options.EVENT_PRE_INIT:this.options.EVENT_PRE_REINIT,i=(this.runEvent(i,e,n),this.getRouteItem(e)),n=t===this.options.EVENT_INIT?this.options.RUN_RENDER_BEFORE_EVENT_INIT:this.options.RUN_RENDER_BEFORE_EVENT_REINIT,t=t===this.options.EVENT_INIT?"runRenderBeforeInit":"runRenderBeforeReinit";(void 0===i[t]?n:i[t])&&this.options.renderFunction&&this.utils.isFunction(this.options.renderFunction)&&this.options.renderFunction(this.buildPageInstance(e))},buildPageInstance:function(t){return{id:t,el:document.getElementById(t)}},addNextPage:function(t,e,n){return e instanceof HTMLElement?(t.insertAdjacentElement("afterend",e),e.classList.add("nextPage"),e.classList.add("hidden"),e.classList.remove("alive")):t.insertAdjacentHTML("afterend",'<div class="nextPage hidden page" id="'+n+'">'+e+"</div>"),document.getElementById(n)},retireCurrentPage:function(t,e){t=this.getRouteItem(t);t&&t.keepAlive?(e.removeAttribute("class"),e.classList.add("page"),e.classList.add("alive")):e.remove()},runEvent:function(t,e,n){t==this.defaultOptions.EVENT_INIT&&this.addEventListenersForLinks(e);e=this.options.eventsByPage[e];e&&(n={params:n.params||{}},e[t])&&this.utils.isFunction(e[t])&&e[t](n)},defaultOptions:{updateOnLoad:!0,preloadPagesOnLoad:!1,animationOut:"slide-out-top",animationIn:"scale-in-center",animateTransitionsOnLoad:!1,PAGE_PREFIX:"!",PAGE_ID_HOME:"[home]",PAGE_ID_404_ERROR:"[404]",EVENT_PRE_INIT:"preInit",EVENT_INIT:"init",EVENT_PRE_REINIT:"preReinit",EVENT_REINIT:"reinit",EVENT_MOUNTED:"mounted",EVENT_BEFORE_OUT:"beforeOut",EVENT_AFTER_OUT:"afterOut",RUN_RENDER_BEFORE_EVENT_INIT:!0,RUN_RENDER_BEFORE_EVENT_REINIT:!1},htmlFetcher:{}};blueRouter.htmlFetcher.loadAllUrls=function(t,n){t=t.options.routes||[];let i=0;t.map(e=>{var t=e.url;t&&(++i,blueRouter.htmlFetcher.loadUrl(t).then(function(t){e.content=t,0==--i&&n&&blueRouter.utils.isFunction(n)&&n()}))})},blueRouter.htmlFetcher.loadUrl=async function(t){var e=await fetch(t);if(e.ok)return await e.text();throw t=`Error fetching ${t} has occured: `+e.status,alert(t),new Error(t)},blueRouter.utils={},blueRouter.utils.analizeUrl=function(t,e){var n={},t=t.split(e.PAGE_PREFIX),t=(n.prepage=t[0],t[1]||""),t=(n.prepage.endsWith("#")&&(n.prepage=n.prepage.slice(0,-1)),t.split("?")),e=(n.page=t[0],""==n.page&&(n.page=e.PAGE_ID_HOME),t[1]||"");if(n.params={},""!=e){var i=e.split("&");for(let t=0;t<i.length;t++){var s=i[t].split("="),o=s[0];n.params[o]=s[1]}}return n},blueRouter.utils.addEventListenerOnList=function(n,i,s){for(let t=0,e=n.length;t<e;t++)n[t].addEventListener(i,s,!1)},blueRouter.utils.extend=function(t,e,n){t=t||{};for(var i=1;i<arguments.length;i++)if(arguments[i])for(var s in arguments[i])arguments[i].hasOwnProperty(s)&&(t[s]=arguments[i][s]);return t},blueRouter.utils.isFunction=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType},"object"==typeof module&&module.exports&&(module.exports=blueRouter);